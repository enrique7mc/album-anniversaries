{"ast":null,"code":"import { inject } from '@angular/core';\nimport { client_id, scope, stateKey } from './constants';\nimport { SpotifyService } from './spotify.service';\nimport { APP_CONFIG } from './app-config';\nimport { Subject } from 'rxjs';\nimport { map, takeUntil, take } from 'rxjs/operators';\nimport { Functions } from '@angular/fire/functions';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./spotify.service\";\nfunction AppComponent_mat_progress_bar_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-progress-bar\", 5);\n  }\n}\nfunction AppComponent_div_4_app_artist_card_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-artist-card\", 9);\n  }\n  if (rf & 2) {\n    const artist_r1 = ctx.$implicit;\n    i0.ɵɵproperty(\"artist\", artist_r1);\n  }\n}\nfunction AppComponent_div_4_app_artist_card_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-artist-card\", 9);\n  }\n  if (rf & 2) {\n    const artist_r2 = ctx.$implicit;\n    i0.ɵɵproperty(\"artist\", artist_r2);\n  }\n}\nfunction AppComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 6)(1, \"h1\");\n    i0.ɵɵtext(2, \"These albums were released this week in the past!\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 7);\n    i0.ɵɵtemplate(4, AppComponent_div_4_app_artist_card_4_Template, 1, 1, \"app-artist-card\", 8);\n    i0.ɵɵpipe(5, \"async\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"h1\");\n    i0.ɵɵtext(7, \"Albums released last year\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"div\", 7);\n    i0.ɵɵtemplate(9, AppComponent_div_4_app_artist_card_9_Template, 1, 1, \"app-artist-card\", 8);\n    i0.ɵɵpipe(10, \"async\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(5, 2, ctx_r2.artists$));\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(10, 4, ctx_r2.artistsWithRecentAlbums$));\n  }\n}\nfunction AppComponent_button_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 10);\n    i0.ɵɵlistener(\"click\", function AppComponent_button_6_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.login());\n    });\n    i0.ɵɵtext(1, \" Login \");\n    i0.ɵɵelementEnd();\n  }\n}\nexport let AppComponent = /*#__PURE__*/(() => {\n  class AppComponent {\n    constructor(spotifyService, config) {\n      this.spotifyService = spotifyService;\n      this.config = config;\n      this.params = null;\n      this.showAlbumBirthdayList = false;\n      this.loading = false;\n      this._destroyed$ = new Subject();\n      this.fn = inject(Functions);\n      this.title = config.title;\n    }\n    ngOnInit() {\n      this.params = this.getHashParams();\n      this.accessToken = this.params['access_token'];\n      console.log(this.getCode());\n      if (this.authError) {\n        console.error('There was an error during the authentication');\n        return;\n      }\n      // localStorage.removeItem(stateKey);\n      if (this.accessToken) {\n        this.loading = true;\n        const doneLoading$ = this.spotifyService.loadArtistsWithAlbums(this.accessToken);\n        // TODO(me): figure out a better way to do the subscription logic.\n        this.artistsWithRecentAlbums$ = this.spotifyService.artists.pipe(map(artists => artists.map(a => Object.assign({}, a))), map(artists => artists.filter(artist => {\n          artist.albums = artist.albums.filter(SpotifyService.albumReleasedPastYear);\n          return artist.albums.length > 0;\n        }), takeUntil(this._destroyed$)));\n        this.artists$ = this.spotifyService.artists.pipe(map(artists => artists.map(a => Object.assign({}, a))), map(artists => artists.filter(artist => {\n          artist.albums = artist.albums.filter(SpotifyService.albumHadBirthdayPastWeek);\n          return artist.albums.length > 0;\n        }), takeUntil(this._destroyed$)));\n        doneLoading$.pipe(takeUntil(this._destroyed$), take(1)).subscribe(() => this.loading = false);\n      }\n    }\n    ngOnDestroy() {\n      this._destroyed$.next();\n      this._destroyed$.complete();\n    }\n    get authError() {\n      let state = this.params['state'];\n      let storedState = localStorage.getItem(stateKey);\n      return this.accessToken && (state == null || state !== storedState);\n    }\n    getCode() {\n      const urlParams = new URLSearchParams(window.location.search);\n      return urlParams.get('code');\n    }\n    getHashParams() {\n      let hashParams = {};\n      let e,\n        r = /([^&;=]+)=?([^&;]*)/g,\n        q = window.location.hash.substring(1);\n      while (e = r.exec(q)) {\n        hashParams[e[1]] = decodeURIComponent(e[2]);\n      }\n      return hashParams;\n    }\n    generateRandomString(length) {\n      let text = '';\n      const possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n      for (let i = 0; i < length; i++) {\n        text += possible.charAt(Math.floor(Math.random() * possible.length));\n      }\n      return text;\n    }\n    login() {\n      let state = this.generateRandomString(16);\n      localStorage.setItem(stateKey, state);\n      var url = 'https://accounts.spotify.com/authorize';\n      url += '?response_type=token';\n      url += `&client_id=${encodeURIComponent(client_id)}`;\n      url += `&scope=${encodeURIComponent(scope)}`;\n      url += `&redirect_uri=${encodeURIComponent(this.config.redirectUrl)}`;\n      url += `&state=${encodeURIComponent(state)}`;\n      window.location.href = url;\n    }\n    authorize() {\n      let state = this.generateRandomString(16);\n      localStorage.setItem(stateKey, state);\n      var url = 'https://accounts.spotify.com/authorize';\n      url += '?response_type=code';\n      url += `&client_id=${encodeURIComponent(client_id)}`;\n      url += `&scope=${encodeURIComponent(scope)}`;\n      url += `&redirect_uri=${encodeURIComponent(this.config.redirectUrl)}`;\n      url += `&state=${encodeURIComponent(state)}`;\n      window.location.href = url;\n    }\n    static {\n      this.ɵfac = function AppComponent_Factory(t) {\n        return new (t || AppComponent)(i0.ɵɵdirectiveInject(i1.SpotifyService), i0.ɵɵdirectiveInject(APP_CONFIG));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: AppComponent,\n        selectors: [[\"app-root\"]],\n        decls: 7,\n        vars: 4,\n        consts: [[\"color\", \"primary\", 1, \"sticky-nav\"], [\"color\", \"primary\", \"mode\", \"indeterminate\", 4, \"ngIf\"], [\"class\", \"container\", 4, \"ngIf\"], [1, \"login\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\", 4, \"ngIf\"], [\"color\", \"primary\", \"mode\", \"indeterminate\"], [1, \"container\"], [1, \"artist-list\"], [3, \"artist\", 4, \"ngFor\", \"ngForOf\"], [3, \"artist\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\"]],\n        template: function AppComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"mat-toolbar\", 0)(1, \"span\");\n            i0.ɵɵtext(2);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵtemplate(3, AppComponent_mat_progress_bar_3_Template, 1, 0, \"mat-progress-bar\", 1)(4, AppComponent_div_4_Template, 11, 6, \"div\", 2);\n            i0.ɵɵelementStart(5, \"div\", 3);\n            i0.ɵɵtemplate(6, AppComponent_button_6_Template, 2, 0, \"button\", 4);\n            i0.ɵɵelementEnd();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(2);\n            i0.ɵɵtextInterpolate(ctx.title);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.loading);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading && ctx.accessToken);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", !ctx.accessToken);\n          }\n        },\n        styles: [\"@media only screen and (min-device-width: 320px) and (max-device-width: 800px){.container{width:90%;margin:0 auto}.artist-list{max-width:460px}.artist-list>*:not(:last-child){margin-bottom:8px}}@media only screen and (min-device-width: 800px){.container{width:50%;margin:0 auto}.artist-list{max-width:600px}.artist-list>*:not(:last-child){margin-bottom:16px}}body{background-color:#fafafa;padding-top:64px}.artist-list{display:flex;flex-direction:column}.login{width:50%;margin:100px auto}.sticky-nav{position:fixed;right:0;left:0;top:0;z-index:999}\\n\"],\n        encapsulation: 2\n      });\n    }\n  }\n  return AppComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}